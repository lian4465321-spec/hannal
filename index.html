<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>한날</title>

  <style>
    html, body { height: 100%; }
    html { height: -webkit-fill-available; }

    /* 기본(라이트) 토큰 */
    :root{
      --bg: #f7f5f2;
      --text: rgba(0,0,0,0.88);
      --muted: rgba(0,0,0,0.55);
      --hint: rgba(0,0,0,0.38);
      --frame: rgba(34,34,34,0.12); /* ✅ 확정 0.12 */
      --input-bg: rgba(255,255,255,0.60);
      --input-bd: rgba(0,0,0,0.12);
      --btn-primary-bg: rgba(0,0,0,0.07);
      --btn-primary-text: rgba(0,0,0,0.88);
      --btn-secondary-bg: rgba(0,0,0,0.04);
      --btn-secondary-text: rgba(0,0,0,0.75);
      --link: rgba(0,0,0,0.52);
    }

    /* 기기 다크모드(수동 light로 덮지 않은 경우만) */
    @media (prefers-color-scheme: dark) {
      :root:not([data-theme="light"]) {
        --bg: #11110f;
        --text: rgba(255,255,255,0.92);
        --muted: rgba(255,255,255,0.62);
        --hint: rgba(255,255,255,0.45);
        --frame: rgba(255,255,255,0.12);
        --input-bg: rgba(255,255,255,0.06);
        --input-bd: rgba(255,255,255,0.14);
        --btn-primary-bg: rgba(255,255,255,0.10);
        --btn-primary-text: rgba(255,255,255,0.92);
        --btn-secondary-bg: rgba(255,255,255,0.07);
        --btn-secondary-text: rgba(255,255,255,0.85);
        --link: rgba(255,255,255,0.62);
      }
    }

    /* 수동 다크/라이트 우선 */
    :root[data-theme="dark"]{
      --bg: #11110f;
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.62);
      --hint: rgba(255,255,255,0.45);
      --frame: rgba(255,255,255,0.12);
      --input-bg: rgba(255,255,255,0.06);
      --input-bd: rgba(255,255,255,0.14);
      --btn-primary-bg: rgba(255,255,255,0.10);
      --btn-primary-text: rgba(255,255,255,0.92);
      --btn-secondary-bg: rgba(255,255,255,0.07);
      --btn-secondary-text: rgba(255,255,255,0.85);
      --link: rgba(255,255,255,0.62);
    }
    :root[data-theme="light"]{
      --bg: #f7f5f2;
      --text: rgba(0,0,0,0.88);
      --muted: rgba(0,0,0,0.55);
      --hint: rgba(0,0,0,0.38);
      --frame: rgba(34,34,34,0.12);
      --input-bg: rgba(255,255,255,0.60);
      --input-bd: rgba(0,0,0,0.12);
      --btn-primary-bg: rgba(0,0,0,0.07);
      --btn-primary-text: rgba(0,0,0,0.88);
      --btn-secondary-bg: rgba(0,0,0,0.04);
      --btn-secondary-text: rgba(0,0,0,0.75);
      --link: rgba(0,0,0,0.52);
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.85;

      /* ✅ C안 스냅(한 장씩 확실하게) */
      overflow-y: auto;
      scroll-snap-type: y mandatory;
      scroll-snap-stop: always;
      scroll-behavior: smooth;

      /* iOS 체감 안정화 */
      overscroll-behavior-y: none;
      -webkit-overflow-scrolling: touch;
    }

    .page {
      /* ✅ iOS 주소창/하단바 변화 대응 */
      min-height: calc(var(--vh, 1vh) * 100);
      min-height: 100svh;
      min-height: -webkit-fill-available;

      scroll-snap-align: start;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      padding: 0 20px;
      box-sizing: border-box;
      position: relative;
    }

    /* ✅ 내부 프레임 라인 */
    .container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 16px;
      right: 16px;
      bottom: 0;
      border: 1px solid var(--frame);
      border-radius: 12px;
      pointer-events: none;
    }

    /* Intro */
    .intro { text-align: center; }
    .brand { font-size: 30px; font-weight: 500; letter-spacing: 1px; }
    .tagline { font-size: 14px; color: var(--muted); margin-top: 10px; }
    .scroll-hint { margin-top: 40px; font-size: 12px; color: var(--hint); }

    /* Register */
    .register { text-align: left; }
    .register-title {
      text-align: center;
      font-size: 15px;
      color: var(--muted);
      margin-bottom: 18px;
    }

    .birth-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 14px;
    }

    .birth-item { display: flex; align-items: center; gap: 4px; }
    .birth-item input {
      width: 56px;
      padding: 10px 8px;
      text-align: center;
      border-radius: 10px;
      border: 1px solid var(--input-bd);
      background: var(--input-bg);
      font-size: 15px;
      outline: none;
      box-sizing: border-box;
      color: var(--text);
    }
    .birth-item.time input { width: 52px; }
    .birth-item span { font-size: 13px; color: var(--muted); white-space: nowrap; }

    .time-unknown {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      margin-bottom: 12px;
      font-size: 14px;
      color: var(--muted);
    }
    .time-unknown label { cursor: pointer; }

    .actions { display: grid; gap: 10px; margin-top: 10px; }

    button.primary, button.secondary {
      width: 100%;
      border: 0;
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 15px;
      cursor: pointer;
    }
    button.primary { background: var(--btn-primary-bg); color: var(--btn-primary-text); }
    button.secondary { background: var(--btn-secondary-bg); color: var(--btn-secondary-text); }

    .small { text-align: center; font-size: 12px; color: var(--muted); margin-top: 10px; }

    .fade-in { opacity: 0; transform: translateY(8px); transition: opacity 520ms ease, transform 520ms ease; }
    .fade-in.show { opacity: 1; transform: translateY(0); }

    /* Fortune */
    .fortune {
      text-align: center;
      padding-top: 8vh;
      padding-bottom: 8vh;
      box-sizing: border-box;
    }

    .date { font-size: 14px; color: var(--muted); }
    .score { font-size: 18px; margin-top: 10px; }
    .score-desc { font-size: 14px; color: var(--muted); margin-top: 6px; }

    .fortune-text { margin-top: 90px; font-size: 17px; }
    .fortune-text p { margin: 0 0 26px 0; }

    .direction { margin-top: 90px; font-size: 15px; color: var(--text); }
    .direction-head { margin-bottom: 12px; }
    .direction-body { line-height: 1.9; color: var(--text); }

    .mini-link {
      margin-top: 70px;
      font-size: 12px;
      color: var(--muted);
    }
    .mini-link button {
      background: transparent;
      border: 0;
      padding: 0;
      text-decoration: underline;
      color: var(--link);
      cursor: pointer;
      font-size: 12px;
    }
    .mini-link .dot { margin: 0 8px; opacity: .6; }

    /* End */
    .ending { text-align: center; font-size: 13px; color: var(--muted); letter-spacing: 1px; }

    .hidden { display: none !important; }
  </style>
</head>

<body>
  <!-- 1) Intro -->
  <section class="page" id="pageIntro">
    <div class="container intro">
      <div class="brand">한날</div>
      <div class="tagline">nothing more is needed</div>
      <div class="scroll-hint">아래로 스크롤</div>
    </div>
  </section>

  <!-- 2) Register -->
  <section class="page" id="pageRegister">
    <div class="container register">
      <div class="register-title" id="registerTitle">생년월일시를 한 번만 적어두면 됩니다.</div>

      <form id="registerForm" class="fade-in">
        <div class="birth-row">
          <div class="birth-item">
            <input id="year" inputmode="numeric" placeholder="1999" maxlength="4" required />
            <span>년</span>
          </div>
          <div class="birth-item">
            <input id="month" inputmode="numeric" placeholder="07" maxlength="2" required />
            <span>월</span>
          </div>
          <div class="birth-item">
            <input id="day" inputmode="numeric" placeholder="21" maxlength="2" required />
            <span>일</span>
          </div>
          <div class="birth-item time">
            <input id="hour" inputmode="numeric" placeholder="15" maxlength="2" />
            <span>시</span>
          </div>
        </div>

        <div class="time-unknown">
          <input type="checkbox" id="unknownTime" />
          <label for="unknownTime">출생시간 모름</label>
        </div>

        <div class="actions">
          <button class="primary" type="submit" id="saveBtn">저장하고 오늘 보기</button>
          <button class="secondary hidden" type="button" id="cancelBtn">그대로 둘게요</button>
        </div>

        <div class="small">저장은 이 기기(브라우저)에만 됩니다.</div>
      </form>
    </div>
  </section>

  <!-- 3) Fortune -->
  <section class="page" id="pageFortune">
    <div class="container fortune">
      <div class="date" id="todayDate"></div>

      <div class="score">
        오늘의 흐름 점수 <strong id="score"></strong>점
      </div>
      <div class="score-desc" id="scoreDesc"></div>

      <div class="fortune-text">
        <p id="line1"></p>
        <p id="line2"></p>
      </div>

      <div class="direction">
        <div class="direction-head">오늘은</div>
        <div class="direction-body" id="direction"></div>
      </div>

      <div class="mini-link">
        <button type="button" id="editBtn">정보 바꾸기</button>
        <span class="dot">·</span>
        <button type="button" id="themeToggle">화면 전환</button>
      </div>
    </div>
  </section>

  <!-- 4) End -->
  <section class="page" id="pageEnd">
    <div class="container ending">HANNAL</div>
  </section>

  <script>
    /*********************************************************
     * iOS 최적화: 실제 뷰포트 높이를 CSS 변수(--vh)로 반영
     *********************************************************/
    function setVH() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    setVH();
    window.addEventListener('resize', setVH);

    /*********************************************************
     * 다크/라이트 토글(기기설정 -> 다크 고정 -> 라이트 고정 -> 기기설정)
     *********************************************************/
    const root = document.documentElement;
    const THEME_KEY = "hannal_theme";
    function applyTheme(theme){
      if(theme){
        root.setAttribute("data-theme", theme);
        localStorage.setItem(THEME_KEY, theme);
      } else {
        root.removeAttribute("data-theme");
        localStorage.removeItem(THEME_KEY);
      }
    }
    const savedTheme = localStorage.getItem(THEME_KEY);
    if(savedTheme) applyTheme(savedTheme);

    /********************
     * 유틸
     ********************/
    function pad2(n){ return String(n).padStart(2,"0"); }
    function todayKey() {
      const t = new Date();
      return `${t.getFullYear()}${pad2(t.getMonth()+1)}${pad2(t.getDate())}`;
    }
    function todayKorean() {
      const t = new Date();
      return `${t.getFullYear()}년 ${t.getMonth()+1}월 ${t.getDate()}일`;
    }
    function seededHash(seed) {
      let hash = 0;
      for (let i=0;i<seed.length;i++){
        hash = seed.charCodeAt(i) + ((hash<<5)-hash);
        hash |= 0;
      }
      return Math.abs(hash);
    }
    function pick(arr, seed, salt){
      const v = seededHash(seed + salt);
      return arr[v % arr.length];
    }
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    /********************
     * 사주 기반(자동화용 “톤” 결정 근사)
     * - 사용자는 간지/오행을 보지 않음
     ********************/
    function toJDN(y,m,d){
      const a = Math.floor((14 - m)/12);
      const y2 = y + 4800 - a;
      const m2 = m + 12*a - 3;
      return d + Math.floor((153*m2 + 2)/5) + 365*y2 + Math.floor(y2/4) - Math.floor(y2/100) + Math.floor(y2/400) - 32045;
    }
    function dayPillar(y,m,d){
      const jdn = toJDN(y,m,d);
      const stem = (jdn + 9) % 10;
      const branch = (jdn + 1) % 12;
      return { stem, branch };
    }
    function elementOfStem(stem){
      const group = Math.floor(stem/2);
      return ["WOOD","FIRE","EARTH","METAL","WATER"][group];
    }
    const GEN = { WOOD:"FIRE", FIRE:"EARTH", EARTH:"METAL", METAL:"WATER", WATER:"WOOD" };
    const CTRL = { WOOD:"EARTH", EARTH:"WATER", WATER:"FIRE", FIRE:"METAL", METAL:"WOOD" };
    function relation(a,b){
      if (a === b) return "SAME";
      if (GEN[a] === b) return "GENERATES";
      if (CTRL[a] === b) return "CONTROLS";
      if (GEN[b] === a) return "RECEIVES";
      if (CTRL[b] === a) return "PRESSURED";
      return "OTHER";
    }
    function decideTone(profile){
      const { y,m,d } = profile;
      const birthDay = dayPillar(y,m,d);
      const birthDM = elementOfStem(birthDay.stem);

      const t = new Date();
      const todayDay = dayPillar(t.getFullYear(), t.getMonth()+1, t.getDate());
      const todayEl = elementOfStem(todayDay.stem);

      const rel = relation(birthDM, todayEl);

      if (rel === "RECEIVES") return "MOVE";
      if (rel === "SAME") return "HOLD";
      if (rel === "GENERATES") return "REST";
      if (rel === "PRESSURED") return "REST";
      if (rel === "CONTROLS") return "FLOW";
      return "HOLD";
    }

    function scoreFromTone(seed, tone){
      const r = seededHash(seed + "_SCORE");
      const jitter = r % 8; // 0~7
      const baseRanges = {
        REST: [30, 54],
        HOLD: [50, 69],
        FLOW: [65, 84],
        MOVE: [80, 100]
      };
      const [lo, hi] = baseRanges[tone] || [50, 69];
      const v = lo + (r % (hi - lo + 1));
      return clamp(v + (jitter - 3), 30, 100);
    }
    function scoreOneLine(score){
      if (score >= 90) return "방향이 비교적 또렷한 편인 것 같습니다.";
      if (score >= 75) return "움직인 만큼 반응이 돌아오는 편인 것 같습니다.";
      if (score >= 60) return "크게 흔들리지 않는 흐름인 것 같습니다.";
      if (score >= 45) return "무리하지 않으면 흐름이 안정될 것 같습니다.";
      return "속도를 늦춰도 충분할 것 같습니다.";
    }

    /********************
     * 문장 풀 200 (STATE 80 / CHOICE 80 / DIRECTION 40)
     ********************/
    const STATE = [
      "천천히 흘러가도 괜찮을 것 같습니다.","오늘 하루는 급하지 않은 쪽에 가까울 것 같습니다.","조용한 리듬이 어색하지 않은 날인 것 같습니다.","힘을 주지 않아도 이어질 것 같습니다.",
      "담담하게 지나가도 무리는 없을 것 같습니다.","오늘의 공기는 비교적 가벼운 편인 것 같습니다.","서두르지 않아도 흐름이 끊기지 않을 것 같습니다.","크게 흔들리지 않는 하루에 가까울 것 같습니다.",
      "조심스럽게 움직여도 충분할 것 같습니다.","오늘은 여유가 남아 있는 편인 것 같습니다.","속도를 줄여도 어색하지 않을 것 같습니다.","무리하지 않으면 안정적으로 이어질 것 같습니다.",
      "오늘은 소리가 크지 않은 날인 것 같습니다.","천천히 살펴봐도 늦지 않을 것 같습니다.","자연스러운 흐름이 유지될 것 같습니다.","오늘은 공백이 허용되는 하루인 것 같습니다.",
      "가볍게 흘려보내도 괜찮을 것 같습니다.","조용한 선택이 잘 어울릴 것 같습니다.","오늘의 리듬은 느슨한 쪽에 가까울 것 같습니다.","크게 애쓰지 않아도 지나갈 것 같습니다.",
      "부드럽게 이어지는 흐름인 것 같습니다.","오늘은 멈춤이 어색하지 않을 것 같습니다.","긴장을 풀어도 무리는 없을 것 같습니다.","오늘 하루는 밀도가 낮은 편인 것 같습니다.",
      "서서히 움직여도 괜찮을 것 같습니다.","오늘은 조정이 가능한 날인 것 같습니다.","천천히 정리해도 충분할 것 같습니다.","소소한 흐름이 이어질 것 같습니다.",
      "오늘은 크게 드러나지 않아도 괜찮을 것 같습니다.","여백이 남아 있는 하루인 것 같습니다.","가볍게 머물러도 어색하지 않을 것 같습니다.","오늘은 속도를 나중에 올려도 될 것 같습니다.",
      "조용히 관찰해도 충분할 것 같습니다.","오늘의 흐름은 완만한 편인 것 같습니다.","부담을 덜어내도 괜찮을 것 같습니다.","자연스럽게 흘려보내도 무리는 없을 것 같습니다.",
      "오늘은 단순함이 잘 맞을 것 같습니다.","힘을 나누어 써도 충분할 것 같습니다.","조용히 유지되는 흐름인 것 같습니다.","오늘은 급할 이유가 크지 않을 것 같습니다.",
      "오늘은 흐름이 천천히 정돈되는 쪽에 가까울 것 같습니다.","가볍게 흘러가도 어색하지 않은 하루인 것 같습니다.","오늘의 공기는 크게 요동치지 않을 것 같습니다.","속도를 낮추어도 흐름이 유지될 것 같습니다.",
      "오늘은 조급함이 필요하지 않은 날인 것 같습니다.","부드러운 리듬이 이어질 가능성이 클 것 같습니다.","오늘 하루는 비교적 평탄한 쪽에 가까울 것 같습니다.","큰 변화를 만들지 않아도 괜찮을 것 같습니다.",
      "오늘은 잔잔한 흐름이 기본이 될 것 같습니다.","가볍게 머물러도 부담은 크지 않을 것 같습니다.","오늘의 리듬은 느리게 이어지는 편인 것 같습니다.","조용한 선택이 자연스러워 보이는 날인 것 같습니다.",
      "오늘은 무게를 덜어도 괜찮을 것 같습니다.","크게 드러나지 않아도 흐름은 이어질 것 같습니다.","오늘의 공기는 비교적 안정적인 편인 것 같습니다.","서두르지 않아도 상황이 흘러갈 것 같습니다.",
      "오늘은 멈춤과 이동의 경계가 느슨한 날인 것 같습니다.","힘을 조절하며 움직여도 충분할 것 같습니다.","오늘의 흐름은 조용히 이어질 가능성이 클 것 같습니다.","가볍게 정리해도 무리는 없을 것 같습니다.",
      "오늘은 크게 흔들리지 않는 리듬인 것 같습니다.","서서히 방향을 살펴봐도 괜찮을 것 같습니다.","오늘의 공기는 부담이 적은 쪽에 가까울 것 같습니다.","조용히 유지되는 흐름이 기본일 것 같습니다.",
      "오늘은 과한 움직임이 필요하지 않을 것 같습니다.","가볍게 지나쳐도 문제가 되지 않을 것 같습니다.","오늘의 리듬은 완만하게 이어질 것 같습니다.","크게 힘을 쓰지 않아도 충분할 것 같습니다.",
      "오늘은 속도를 조절하기 쉬운 날인 것 같습니다.","담담하게 흘려보내도 괜찮을 것 같습니다.","오늘의 공기는 비교적 느긋한 편인 것 같습니다.","서두르지 않는 쪽이 자연스러워 보일 것 같습니다.",
      "오늘은 조용한 흐름이 오래 갈 것 같습니다.","무게를 줄여도 흐름이 깨지지 않을 것 같습니다.","오늘의 리듬은 낮게 유지되는 편인 것 같습니다.","가볍게 머무는 선택이 어울릴 것 같습니다.",
      "오늘은 큰 조정 없이도 지나갈 것 같습니다.","천천히 이어지는 흐름이 기본이 될 것 같습니다.","오늘의 공기는 단순한 편에 가깝습니다.","조용히 흘러가도 충분한 하루인 것 같습니다."
    ];

    const CHOICE = [
      "선택을 줄여도 충분할 것 같습니다.","결론을 서두르지 않아도 괜찮을 것 같습니다.","지금 상태를 유지해도 무리는 없을 것 같습니다.","한 박자 늦춰도 괜찮을 것 같습니다.",
      "굳이 앞서지 않아도 될 것 같습니다.","잠시 미뤄두는 선택도 괜찮을 것 같습니다.","지금은 더 보태지 않아도 충분할 것 같습니다.","방향을 크게 바꾸지 않아도 될 것 같습니다.",
      "말을 아껴도 괜찮을 것 같습니다.","판단을 나중에 해도 늦지 않을 것 같습니다.","굳이 확답하지 않아도 될 것 같습니다.","오늘은 정리하지 않아도 괜찮을 것 같습니다.",
      "서두르지 않는 쪽이 편할 것 같습니다.","지금의 선택을 유지해도 충분할 것 같습니다.","결정을 나누어 해도 괜찮을 것 같습니다.","굳이 증명하지 않아도 될 것 같습니다.",
      "오늘은 반응을 줄여도 괜찮을 것 같습니다.","방향을 그대로 두어도 무리는 없을 것 같습니다.","지금은 멈춰보는 것도 괜찮을 것 같습니다.","선택을 최소화해도 충분할 것 같습니다.",
      "말을 덜어내는 쪽이 나을 것 같습니다.","판단을 유보해도 괜찮을 것 같습니다.","지금의 흐름에 맡겨도 될 것 같습니다.","굳이 서두를 필요는 없을 것 같습니다.",
      "오늘은 조정하는 쪽이 편할 것 같습니다.","한 걸음 물러나도 괜찮을 것 같습니다.","방향을 고정하지 않아도 될 것 같습니다.","오늘은 유지하는 선택이 무난할 것 같습니다.",
      "굳이 나서지 않아도 괜찮을 것 같습니다.","선택을 보류해도 충분할 것 같습니다.","지켜보는 쪽이 나을 것 같습니다.","말보다 행동을 줄여도 괜찮을 것 같습니다.",
      "오늘은 무리하지 않는 편이 좋을 것 같습니다.","방향을 서서히 잡아도 될 것 같습니다.","굳이 완성하려 하지 않아도 괜찮을 것 같습니다.","선택을 남겨두는 것도 괜찮을 것 같습니다.",
      "지금의 판단을 믿지 않아도 괜찮을 것 같습니다.","오늘은 단순하게 두는 편이 나을 것 같습니다.","흐름을 방해하지 않는 쪽이 좋을 것 같습니다.","결론을 내리지 않아도 충분할 것 같습니다.",
      "오늘은 선택을 덜어내는 쪽이 나을 것 같습니다.","굳이 결론을 내리지 않아도 괜찮을 것 같습니다.","지금의 방향을 그대로 두어도 될 것 같습니다.","판단을 서두르지 않는 편이 편할 것 같습니다.",
      "오늘은 조정하지 않아도 충분할 것 같습니다.","선택을 남겨두는 쪽이 나을 것 같습니다.","굳이 설명하지 않아도 괜찮을 것 같습니다.","오늘은 반응을 줄이는 편이 좋을 것 같습니다.",
      "흐름을 따라가도 무리는 없을 것 같습니다.","지금은 유지에 가까운 선택이 편할 것 같습니다.","굳이 앞서서 결정하지 않아도 될 것 같습니다.","오늘은 방향을 고정하지 않는 편이 나을 것 같습니다.",
      "말을 아끼는 쪽이 부담이 적을 것 같습니다.","선택을 미뤄도 흐름이 깨지지 않을 것 같습니다.","오늘은 정리보다 유지가 나을 것 같습니다.","굳이 결과를 만들지 않아도 괜찮을 것 같습니다.",
      "지금의 상태를 존중해도 충분할 것 같습니다.","판단을 나중으로 넘겨도 무리는 없을 것 같습니다.","오늘은 크게 움직이지 않는 편이 좋을 것 같습니다.","선택을 줄이는 쪽이 편안할 것 같습니다.",
      "굳이 서두를 이유는 크지 않을 것 같습니다.","오늘은 결정을 가볍게 두어도 괜찮을 것 같습니다.","방향을 열어두는 선택이 나을 것 같습니다.","지금은 유지 쪽에 가까운 선택이 좋을 것 같습니다.",
      "오늘은 무리하지 않는 판단이 어울릴 것 같습니다.","굳이 앞장서지 않아도 괜찮을 것 같습니다.","선택을 단순하게 가져가도 충분할 것 같습니다.","오늘은 흐름을 방해하지 않는 편이 좋을 것 같습니다.",
      "결정을 미뤄두는 쪽이 편할 것 같습니다.","지금의 상태를 그대로 두는 선택이 나을 것 같습니다.","오늘은 조심스럽게 유지해도 괜찮을 것 같습니다.","방향을 확정하지 않아도 무리는 없을 것 같습니다.",
      "굳이 모든 걸 정리하지 않아도 괜찮을 것 같습니다.","선택을 가볍게 넘겨도 될 것 같습니다.","오늘은 판단을 덜어내는 편이 나을 것 같습니다.","굳이 반응하지 않아도 괜찮을 것 같습니다.",
      "지금은 유지에 집중해도 충분할 것 같습니다.","선택을 최소화하는 쪽이 편할 것 같습니다.","오늘은 조정 없이 두는 편이 나을 것 같습니다.","결론을 내리지 않는 선택도 괜찮을 것 같습니다."
    ];

    const DIRECTION = [
      "유지하는 선택이 편할 것 같습니다.","굳이 앞에 나서지 않아도 괜찮을 것 같습니다.","더 보태지 않아도 충분할 것 같습니다.","말을 줄이는 쪽이 나을 것 같습니다.",
      "지금 상태를 지키는 편이 무난할 것 같습니다.","흐름을 끊지 않는 선택이 좋을 것 같습니다.","조용히 지나가는 쪽이 편할 것 같습니다.","무리하지 않는 방향이 잘 맞을 것 같습니다.",
      "지금의 리듬을 유지하는 게 좋을 것 같습니다.","앞서기보다는 맞추는 쪽이 나을 것 같습니다.","서두르지 않는 태도가 어울릴 것 같습니다.","방향을 크게 바꾸지 않는 게 좋을 것 같습니다.",
      "잠시 멈추는 선택이 편할 것 같습니다.","여백을 남기는 쪽이 나을 것 같습니다.","지금 상태를 그대로 두는 게 좋을 것 같습니다.","굳이 나서지 않는 태도가 어울릴 것 같습니다.",
      "흐름에 맡기는 쪽이 편할 것 같습니다.","선택을 줄이는 게 좋을 것 같습니다.","방향을 유연하게 두는 게 좋을 것 같습니다.","오늘은 유지하는 쪽이 무난할 것 같습니다.",
      "조정하지 않아도 되는 방향이 좋을 것 같습니다.","지금의 흐름을 존중하는 게 좋을 것 같습니다.","크게 바꾸지 않는 선택이 편할 것 같습니다.","굳이 강조하지 않는 쪽이 나을 것 같습니다.",
      "속도를 낮추는 방향이 좋을 것 같습니다.","조용히 이어가는 태도가 어울릴 것 같습니다.","지금 상태에 머무는 게 편할 것 같습니다.","방향을 열어두는 쪽이 좋을 것 같습니다.",
      "오늘은 유지에 가까운 선택이 나을 것 같습니다.","흐름을 방해하지 않는 쪽이 편할 것 같습니다.",
      "오늘은 유지에 가까운 방향이 편할 것 같습니다.","흐름을 크게 바꾸지 않는 쪽이 좋을 것 같습니다.","조용히 이어가는 선택이 어울릴 것 같습니다.","지금의 리듬을 존중하는 방향이 나을 것 같습니다.",
      "앞서기보다는 맞추는 쪽이 편할 것 같습니다.","무리하지 않는 방향이 잘 어울릴 것 같습니다.","지금 상태를 지켜보는 선택이 좋을 것 같습니다.","방향을 열어두는 태도가 어울릴 것 같습니다.",
      "오늘은 유지하는 흐름이 자연스러울 것 같습니다.","흐름을 방해하지 않는 방향이 편할 것 같습니다."
    ];

    const TONES = ["REST","HOLD","FLOW","MOVE"];
    function sliceByTone(arr, tone){
      const idx = TONES.indexOf(tone);
      const chunk = Math.floor(arr.length / 4);
      const start = idx * chunk;
      const end = (idx === 3) ? arr.length : start + chunk;
      return arr.slice(start, end);
    }

    /********************
     * 저장/로드
     ********************/
    const STORAGE_KEY = "hannal_profile";
    function saveProfile(p){ localStorage.setItem(STORAGE_KEY, JSON.stringify(p)); }
    function loadProfile(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return null;
      try { return JSON.parse(raw); } catch { return null; }
    }
    function buildBirthKey(p){
      const y = String(p.y).padStart(4,"0");
      const m = pad2(p.m);
      const d = pad2(p.d);
      if(!p.timeKnown) return `${y}${m}${d}`;
      const hh = pad2(p.hour);
      return `${y}${m}${d}${hh}00`;
    }

    /********************
     * 렌더
     ********************/
    function render(profile){
      const birthKey = buildBirthKey(profile);
      const seed = `${birthKey}_${todayKey()}`;

      const tone = decideTone(profile);
      const score = scoreFromTone(seed, tone);

      const S = sliceByTone(STATE, tone);
      const C = sliceByTone(CHOICE, tone);
      const D = sliceByTone(DIRECTION, tone);

      document.getElementById("todayDate").innerText = todayKorean();
      document.getElementById("score").innerText = score;
      document.getElementById("scoreDesc").innerText = scoreOneLine(score);

      document.getElementById("line1").innerText = pick(S, seed, "_S");
      document.getElementById("line2").innerText = pick(C, seed, "_C");
      document.getElementById("direction").innerText = pick(D, seed, "_D");
    }

    /********************
     * UI
     ********************/
    const pageRegister = document.getElementById("pageRegister");
    const registerTitle = document.getElementById("registerTitle");
    const form = document.getElementById("registerForm");
    const saveBtn = document.getElementById("saveBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const editBtn = document.getElementById("editBtn");
    const themeToggle = document.getElementById("themeToggle");

    const unknownTime = document.getElementById("unknownTime");
    const hourInput = document.getElementById("hour");

    function setTimeInputsState(){
      const disabled = unknownTime.checked;
      hourInput.disabled = disabled;
      if(disabled) hourInput.value = "";
    }
    unknownTime.addEventListener("change", setTimeInputsState);

    function isValidDate(y,m,d){
      const dt = new Date(y, m-1, d);
      return dt.getFullYear()===y && dt.getMonth()===(m-1) && dt.getDate()===d;
    }

    function fillForm(p){
      document.getElementById("year").value = p.y;
      document.getElementById("month").value = pad2(p.m);
      document.getElementById("day").value = pad2(p.d);
      unknownTime.checked = !p.timeKnown;
      setTimeInputsState();
      hourInput.value = p.timeKnown ? pad2(p.hour) : "";
    }

    function enterNormalMode(saved){
      /* 등록 완료 후: 입력 페이지 숨김 (자동 스크롤 없음) */
      pageRegister.classList.add("hidden");
      registerTitle.innerText = "생년월일시를 한 번만 적어두면 됩니다.";
      cancelBtn.classList.add("hidden");
      saveBtn.innerText = "저장하고 오늘 보기";
      if(saved) render(saved);
    }

    function enterFirstRegisterMode(){
      pageRegister.classList.remove("hidden");
      registerTitle.innerText = "생년월일시를 한 번만 적어두면 됩니다.";
      cancelBtn.classList.add("hidden");
      saveBtn.innerText = "저장하고 오늘 보기";
      requestAnimationFrame(()=>form.classList.add("show"));
    }

    function enterEditMode(saved){
      pageRegister.classList.remove("hidden");
      registerTitle.innerText = "정보수정";
      cancelBtn.classList.remove("hidden");
      saveBtn.innerText = "저장하고 오늘 보기";
      fillForm(saved);
      requestAnimationFrame(()=>form.classList.add("show"));
    }

    cancelBtn.addEventListener("click", ()=>{
      const saved = loadProfile();
      if(saved) enterNormalMode(saved);
      else enterFirstRegisterMode();
    });

    editBtn.addEventListener("click", ()=>{
      const saved = loadProfile();
      if(!saved) { enterFirstRegisterMode(); return; }
      enterEditMode(saved);
    });

    themeToggle.addEventListener("click", ()=>{
      const current = root.getAttribute("data-theme");
      if (current === "dark") applyTheme("light");
      else if (current === "light") applyTheme(null); // 기기 설정으로 복귀
      else applyTheme("dark");
    });

    form.addEventListener("submit", (e)=>{
      e.preventDefault();

      const y = parseInt(document.getElementById("year").value, 10);
      const m = parseInt(document.getElementById("month").value, 10);
      const d = parseInt(document.getElementById("day").value, 10);

      if(!y || !m || !d || !isValidDate(y,m,d)){
        alert("생년월일을 다시 확인해주세요.");
        return;
      }

      const timeKnown = !unknownTime.checked;
      let hour = 0;

      if(timeKnown){
        const h = hourInput.value.trim();
        if(h === ""){
          alert("출생시간을 모르면 '출생시간 모름'을 체크해주세요.");
          return;
        }
        hour = parseInt(h, 10);
        if(Number.isNaN(hour) || hour < 0 || hour > 23){
          alert("출생시간(시)은 0~23 사이로 입력해주세요.");
          return;
        }
      }

      const profile = { y, m, d, timeKnown, hour };
      saveProfile(profile);

      /* ✅ 저장해도 자동 화면전환 없음 */
      enterNormalMode(profile);
    });

    /* 초기 */
    setTimeInputsState();
    const saved = loadProfile();
    requestAnimationFrame(()=>form.classList.add("show"));
    if(saved) enterNormalMode(saved);
    else enterFirstRegisterMode();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>한날</title>

  <style>
    html, body { height: 100%; }
    html { height: -webkit-fill-available; } /* iOS 백업 */

    :root {
      --bg: #f7f5f2;
      --text: rgba(0, 0, 0, 0.88);
      --muted: rgba(0, 0, 0, 0.52);
      --muted2: rgba(0, 0, 0, 0.40);
      --line: rgba(34, 34, 34, 0.12); /* ✅ 프레임 선 0.12 */
      --field-bg: rgba(255, 255, 255, 0.60);
      --field-border: rgba(0, 0, 0, 0.12);
      --btn-primary: rgba(0, 0, 0, 0.07);
      --btn-secondary: rgba(0, 0, 0, 0.04);
      --btn-text: rgba(0,0,0,0.86);
      --btn-text2: rgba(0,0,0,0.76);
      --radius: 12px;
    }

    /* ✅ 시스템 다크모드(단, 사용자가 라이트로 고정하면 제외) */
    @media (prefers-color-scheme: dark) {
      :root:not([data-theme="light"]) {
        --bg: #11110f;
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.62);
        --muted2: rgba(255, 255, 255, 0.45);
        --line: rgba(255, 255, 255, 0.12);
        --field-bg: rgba(255, 255, 255, 0.06);
        --field-border: rgba(255, 255, 255, 0.14);
        --btn-primary: rgba(255, 255, 255, 0.10);
        --btn-secondary: rgba(255, 255, 255, 0.07);
        --btn-text: rgba(255,255,255,0.92);
        --btn-text2: rgba(255,255,255,0.85);
      }
    }

    /* ✅ 사용자가 수동으로 다크 고정 */
    :root[data-theme="dark"] {
      --bg: #11110f;
      --text: rgba(255, 255, 255, 0.92);
      --muted: rgba(255, 255, 255, 0.62);
      --muted2: rgba(255, 255, 255, 0.45);
      --line: rgba(255, 255, 255, 0.12);
      --field-bg: rgba(255, 255, 255, 0.06);
      --field-border: rgba(255, 255, 255, 0.14);
      --btn-primary: rgba(255, 255, 255, 0.10);
      --btn-secondary: rgba(255, 255, 255, 0.07);
      --btn-text: rgba(255,255,255,0.92);
      --btn-text2: rgba(255,255,255,0.85);
    }

    /* ✅ 사용자가 수동으로 라이트 고정 */
    :root[data-theme="light"] {
      --bg: #f7f5f2;
      --text: rgba(0, 0, 0, 0.88);
      --muted: rgba(0, 0, 0, 0.52);
      --muted2: rgba(0, 0, 0, 0.40);
      --line: rgba(34, 34, 34, 0.12);
      --field-bg: rgba(255, 255, 255, 0.60);
      --field-border: rgba(0, 0, 0, 0.12);
      --btn-primary: rgba(0, 0, 0, 0.07);
      --btn-secondary: rgba(0, 0, 0, 0.04);
      --btn-text: rgba(0,0,0,0.86);
      --btn-text2: rgba(0,0,0,0.76);
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.85;

      overflow-y: auto;

      /* ✅ 사용자가 스크롤할 때만 '한 장씩 정렬' */
      scroll-snap-type: y mandatory;
      scroll-snap-stop: always;
      scroll-behavior: smooth;

      /* iOS 체감 안정화 */
      overscroll-behavior-y: none;
      -webkit-overflow-scrolling: touch;
    }

    .page {
      /* ✅ iOS 주소창 변화에도 안정적인 1페이지=1화면 */
      min-height: calc(var(--vh, 1vh) * 100);
      min-height: 100svh;
      min-height: -webkit-fill-available;

      scroll-snap-align: start;

      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      position: relative;
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      padding: 0 20px;
      box-sizing: border-box;
    }

    /* ✅ 프레임 라인(카드 느낌 X, 경계만 정리) */
    .container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 16px;
      right: 16px;
      bottom: 0;
      border: 1px solid var(--line);
      border-radius: var(--radius);
      pointer-events: none;
    }

    /* 첫 화면은 프레임 없이 더 숨 쉬게 (원치 않으면 삭제해도 됨) */
    #pageIntro .container::before { border: none; }

    /* Intro */
    .intro { text-align: center; }
    .brand { font-size: 30px; font-weight: 500; letter-spacing: 1px; }
    .tagline { font-size: 14px; color: var(--muted); margin-top: 10px; }
    .scroll-hint { margin-top: 40px; font-size: 12px; color: var(--muted2); }

    /* Register */
    .register { text-align: left; }
    .register-title {
      text-align: center;
      font-size: 15px;
      color: var(--muted);
      margin-bottom: 18px;
    }

    .birth-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 14px;
    }

    .birth-item { display: flex; align-items: center; gap: 4px; }
    .birth-item input {
      width: 56px;
      padding: 10px 8px;
      text-align: center;
      border-radius: 10px;
      border: 1px solid var(--field-border);
      background: var(--field-bg);
      color: var(--text);
      font-size: 15px;
      outline: none;
      box-sizing: border-box;
    }
    .birth-item.time input { width: 52px; }
    .birth-item span { font-size: 13px; color: var(--muted); white-space: nowrap; }

    .time-unknown {
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      margin-bottom: 12px;
      font-size: 14px;
      color: var(--muted);
    }
    .time-unknown label { cursor: pointer; }

    .actions { display: grid; gap: 10px; margin-top: 10px; }

    button.primary, button.secondary {
      width: 100%;
      border: 0;
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 15px;
      cursor: pointer;
      transition: opacity 220ms ease;
    }
    button.primary { background: var(--btn-primary); color: var(--btn-text); }
    button.secondary { background: var(--btn-secondary); color: var(--btn-text2); }
    button.primary:active, button.secondary:active { opacity: 0.86; }

    .small { text-align: center; font-size: 12px; color: var(--muted2); margin-top: 10px; }

    .fade-in { opacity: 0; transform: translateY(8px); transition: opacity 520ms ease, transform 520ms ease; }
    .fade-in.show { opacity: 1; transform: translateY(0); }

    /* Fortune */
    .fortune {
      text-align: center;
      padding-top: 8vh;
      padding-bottom: 8vh;
      box-sizing: border-box;
    }

    .date { font-size: 14px; color: var(--muted); }
    .score { font-size: 18px; margin-top: 10px; }
    .score-desc { font-size: 14px; color: var(--muted); margin-top: 6px; }

    .fortune-text { margin-top: 90px; font-size: 17px; }
    .fortune-text p { margin: 0 0 26px 0; }

    .direction { margin-top: 90px; font-size: 15px; color: var(--text); }
    .direction-head { margin-bottom: 12px; color: var(--muted); }
    .direction-body { line-height: 1.9; }

    .mini-link {
      margin-top: 70px;
      font-size: 12px;
      color: var(--muted2);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .mini-link button {
      background: transparent;
      border: 0;
      padding: 0;
      text-decoration: underline;
      color: var(--muted);
      cursor: pointer;
      font-size: 12px;
    }
    .mini-link .dot { opacity: 0.55; }

    /* End */
    .ending { text-align: center; font-size: 13px; color: var(--muted2); letter-spacing: 1px; }

    .hidden { display: none !important; }
  </style>
</head>

<body>
  <!-- 1) Intro -->
  <section class="page" id="pageIntro">
    <div class="container intro">
      <div class="brand">한날</div>
      <div class="tagline">nothing more is needed</div>
      <div class="scroll-hint">아래로 스크롤</div>
    </div>
  </section>

  <!-- 2) Register -->
  <section class="page" id="pageRegister">
    <div class="container register">
      <div class="register-title" id="registerTitle">생년월일시를 한 번만 적어두면 됩니다.</div>

      <form id="registerForm" class="fade-in">
        <div class="birth-row">
          <div class="birth-item">
            <input id="year" inputmode="numeric" placeholder="1999" maxlength="4" required />
            <span>년</span>
          </div>
          <div class="birth-item">
            <input id="month" inputmode="numeric" placeholder="07" maxlength="2" required />
            <span>월</span>
          </div>
          <div class="birth-item">
            <input id="day" inputmode="numeric" placeholder="21" maxlength="2" required />
            <span>일</span>
          </div>
          <div class="birth-item time">
            <input id="hour" inputmode="numeric" placeholder="15" maxlength="2" />
            <span>시</span>
          </div>
        </div>

        <div class="time-unknown">
          <input type="checkbox" id="unknownTime" />
          <label for="unknownTime">출생시간 모름</label>
        </div>

        <div class="actions">
          <button class="primary" type="submit" id="saveBtn">저장하고 오늘 보기</button>
          <button class="secondary hidden" type="button" id="cancelBtn">그대로 둘게요</button>
        </div>

        <div class="small">저장은 이 기기(브라우저)에만 됩니다.</div>
      </form>
    </div>
  </section>

  <!-- 3) Fortune -->
  <section class="page" id="pageFortune">
    <div class="container fortune">
      <div class="date" id="todayDate"></div>

      <div class="score">
        오늘의 흐름 점수 <strong id="score"></strong>점
      </div>
      <div class="score-desc" id="scoreDesc"></div>

      <div class="fortune-text">
        <p id="line1"></p>
        <p id="line2"></p>
      </div>

      <div class="direction">
        <div class="direction-head">오늘은</div>
        <div class="direction-body" id="direction"></div>
      </div>

      <div class="mini-link">
        <button type="button" id="editBtn">정보 바꾸기</button>
        <span class="dot">·</span>
        <button type="button" id="themeToggle">화면 전환</button>
      </div>
    </div>
  </section>

  <!-- 4) End -->
  <section class="page" id="pageEnd">
    <div class="container ending">HANNAL</div>
  </section>

  <script>
    /*********************************************************
     * iOS 최적화: 실제 뷰포트 높이를 CSS 변수(--vh)로 반영
     * - 자동 스크롤 아님 (높이만 측정)
     *********************************************************/
    function setVH() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    setVH();
    window.addEventListener('resize', setVH);

    /*********************************************************
     * 다크모드 토글: 기기 설정 ↔ 다크 고정 ↔ 라이트 고정 순환
     *********************************************************/
    const THEME_KEY = "hannal_theme";
    const root = document.documentElement;

    function applyTheme(themeOrNull) {
      if (!themeOrNull) {
        root.removeAttribute("data-theme");
        localStorage.removeItem(THEME_KEY);
        return;
      }
      root.setAttribute("data-theme", themeOrNull);
      localStorage.setItem(THEME_KEY, themeOrNull);
    }

    const savedTheme = localStorage.getItem(THEME_KEY);
    if (savedTheme === "dark" || savedTheme === "light") applyTheme(savedTheme);

    /********************
     * 유틸
     ********************/
    function pad2(n){ return String(n).padStart(2,"0"); }
    function todayKey() {
      const t = new Date();
      return `${t.getFullYear()}${pad2(t.getMonth()+1)}${pad2(t.getDate())}`;
    }
    function todayKorean() {
      const t = new Date();
      return `${t.getFullYear()}년 ${t.getMonth()+1}월 ${t.getDate()}일`;
    }
    function seededHash(seed) {
      let hash = 0;
      for (let i=0;i<seed.length;i++){
        hash = seed.charCodeAt(i) + ((hash<<5)-hash);
        hash |= 0;
      }
      return Math.abs(hash);
    }
    function pick(arr, seed, salt){
      const v = seededHash(seed + salt);
      return arr[v % arr.length];
    }
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    /********************
     * 사주 기반(자동화용 근사)
     * - 간지/오행은 사용자에게 노출하지 않고
     * - 톤(REST/HOLD/FLOW/MOVE)만 고름
     ********************/
    function toJDN(y,m,d){
      const a = Math.floor((14 - m)/12);
      const y2 = y + 4800 - a;
      const m2 = m + 12*a - 3;
      return d + Math.floor((153*m2 + 2)/5) + 365*y2 + Math.floor(y2/4) - Math.floor(y2/100) + Math.floor(y2/400) - 32045;
    }
    function dayPillar(y,m,d){
      const jdn = toJDN(y,m,d);
      const stem = (jdn + 9) % 10;
      const branch = (jdn + 1) % 12;
      return { stem, branch };
    }
    function elementOfStem(stem){
      const group = Math.floor(stem/2);
      return ["WOOD","FIRE","EARTH","METAL","WATER"][group];
    }
    const GEN = { WOOD:"FIRE", FIRE:"EARTH", EARTH:"METAL", METAL:"WATER", WATER:"WOOD" };
    const CTRL = { WOOD:"EARTH", EARTH:"WATER", WATER:"FIRE", FIRE:"METAL", METAL:"WOOD" };
    function relation(a,b){
      if (a === b) return "SAME";
      if (GEN[a] === b) return "GENERATES";
      if (CTRL[a] === b) return "CONTROLS";
      if (GEN[b] === a) return "RECEIVES";
      if (CTRL[b] === a) return "PRESSURED";
      return "OTHER";
    }
    function decideTone(profile){
      const { y,m,d } = profile;

      const birthDay = dayPillar(y,m,d);
      const birthDM = elementOfStem(birthDay.stem);

      const t = new Date();
      const todayDay = dayPillar(t.getFullYear(), t.getMonth()+1, t.getDate());
      const todayEl = elementOfStem(todayDay.stem);

      const rel = relation(birthDM, todayEl);

      if (rel === "RECEIVES") return "MOVE";
      if (rel === "SAME") return "HOLD";
      if (rel === "GENERATES") return "REST";
      if (rel === "PRESSURED") return "REST";
      if (rel === "CONTROLS") return "FLOW";
      return "HOLD";
    }

    function scoreFromTone(seed, tone){
      const r = seededHash(seed + "_SCORE");
      const jitter = r % 8; // 0~7
      const baseRanges = {
        REST: [30, 54],
        HOLD: [50, 69],
        FLOW: [65, 84],
        MOVE: [80, 100]
      };
      const [lo, hi] = baseRanges[tone] || [50, 69];
      const v = lo + (r % (hi - lo + 1));
      return clamp(v + (jitter - 3), 30, 100);
    }

    function scoreOneLine(score){
      if (score >= 90) return "방향이 비교적 또렷한 편인 것 같습니다.";
      if (score >= 75) return "움직인 만큼 반응이 돌아오는 편인 것 같습니다.";
      if (score >= 60) return "크게 흔들리지 않는 흐름인 것 같습니다.";
      if (score >= 45) return "무리하지 않으면 흐름이 안정될 것 같습니다.";
      return "속도를 늦춰도 충분할 것 같습니다.";
    }

    /********************
     * 문장 풀 200 (80/80/40)
     ********************/
    const STATE = [
      "천천히 흘러가도 괜찮을 것 같습니다.","오늘 하루는 급하지 않은 쪽에 가까울 것 같습니다.","조용한 리듬이 어색하지 않은 날인 것 같습니다.","힘을 주지 않아도 이어질 것 같습니다.",
      "담담하게 지나가도 무리는 없을 것 같습니다.","오늘의 공기는 비교적 가벼운 편인 것 같습니다.","서두르지 않아도 흐름이 끊기지 않을 것 같습니다.","크게 흔들리지 않는 하루에 가까울 것 같습니다.",
      "조심스럽게 움직여도 충분할 것 같습니다.","오늘은 여유가 남아 있는 편인 것 같습니다.","속도를 줄여도 어색하지 않을 것 같습니다.","무리하지 않으면 안정적으로 이어질 것 같습니다.",
      "오늘은 소리가 크지 않은 날인 것 같습니다.","천천히 살펴봐도 늦지 않을 것 같습니다.","자연스러운 흐름이 유지될 것 같습니다.","오늘은 공백이 허용되는 하루인 것 같습니다.",
      "가볍게 흘려보내도 괜찮을 것 같습니다.","조용한 선택이 잘 어울릴 것 같습니다.","오늘의 리듬은 느슨한 쪽에 가까울 것 같습니다.","크게 애쓰지 않아도 지나갈 것 같습니다.",
      "부드럽게 이어지는 흐름인 것 같습니다.","오늘은 멈춤이 어색하지 않을 것 같습니다.","긴장을 풀어도 무리는 없을 것 같습니다.","오늘 하루는 밀도가 낮은 편인 것 같습니다.",
      "서서히 움직여도 괜찮을 것 같습니다.","오늘은 조정이 가능한 날인 것 같습니다.","천천히 정리해도 충분할 것 같습니다.","소소한 흐름이 이어질 것 같습니다.",
      "오늘은 크게 드러나지 않아도 괜찮을 것 같습니다.","여백이 남아 있는 하루인 것 같습니다.","가볍게 머물러도 어색하지 않을 것 같습니다.","오늘은 속도를 나중에 올려도 될 것 같습니다.",
      "조용히 관찰해도 충분할 것 같습니다.","오늘의 흐름은 완만한 편인 것 같습니다.","부담을 덜어내도 괜찮을 것 같습니다.","자연스럽게 흘려보내도 무리는 없을 것 같습니다.",
      "오늘은 단순함이 잘 맞을 것 같습니다.","힘을 나누어 써도 충분할 것 같습니다.","조용히 유지되는 흐름인 것 같습니다.","오늘은 급할 이유가 크지 않을 것 같습니다.",
      "오늘은 흐름이 천천히 정돈되는 쪽에 가까울 것 같습니다.","가볍게 흘러가도 어색하지 않은 하루인 것 같습니다.","오늘의 공기는 크게 요동치지 않을 것 같습니다.","속도를 낮추어도 흐름이 유지될 것 같습니다.",
      "오늘은 조급함이 필요하지 않은 날인 것 같습니다.","부드러운 리듬이 이어질 가능성이 클 것 같습니다.","오늘 하루는 비교적 평탄한 쪽에 가까울 것 같습니다.","큰 변화를 만들지 않아도 괜찮을 것 같습니다.",
      "오늘은 잔잔한 흐름이 기본이 될 것 같습니다.","가볍게 머물러도 부담은 크지 않을 것 같습니다.","오늘의 리듬은 느리게 이어지는 편인 것 같습니다.","조용한 선택이 자연스러워 보이는 날인 것 같습니다.",
      "오늘은 무게를 덜어도 괜찮을 것 같습니다.","크게 드러나지 않아도 흐름은 이어질 것 같습니다.","오늘의 공기는 비교적 안정적인 편인 것 같습니다.","서두르지 않아도 상황이 흘러갈 것 같습니다.",
      "오늘은 멈춤과 이동의 경계가 느슨한 날인 것 같습니다.","힘을 조절하며 움직여도 충분할 것 같습니다.","오늘의 흐름은 조용히 이어질 가능성이 클 것 같습니다.","가볍게 정리해도 무리는 없을 것 같습니다.",
      "오늘은 크게 흔들리지 않는 리듬인 것 같습니다.","서서히 방향을 살펴봐도 괜찮을 것 같습니다.","오늘의 공기는 부담이 적은 쪽에 가까울 것 같습니다.","조용히 유지되는 흐름이 기본일 것 같습니다.",
      "오늘은 과한 움직임이 필요하지 않을 것 같습니다.","가볍게 지나쳐도 문제가 되지 않을 것 같습니다.","오늘의 리듬은 완만하게 이어질 것 같습니다.","크게 힘을 쓰지 않아도 충분할 것 같습니다.",
      "오늘은 속도를 조절하기 쉬운 날인 것 같습니다.","담담하게 흘려보내도 괜찮을 것 같습니다.","오늘의 공기는 비교적 느긋한 편인 것 같습니다.","서두르지 않는 쪽이 자연스러워 보일 것 같습니다.",
      "오늘은 조용한 흐름이 오래 갈 것 같습니다.","무게를 줄여도 흐름이 깨지지 않을 것 같습니다.","오늘의 리듬은 낮게 유지되는 편인 것 같습니다.","가볍게 머무는 선택이 어울릴 것 같습니다.",
      "오늘은 큰 조정 없이도 지나갈 것 같습니다.","천천히 이어지는 흐름이 기본이 될 것 같습니다.","오늘의 공기는 단순한 편에 가깝습니다.","조용히 흘러가도 충분한 하루인 것 같습니다."
    ];

    const CHOICE = [
      "선택을 줄여도 충분할 것 같습니다.","결론을 서두르지 않아도 괜찮을 것 같습니다.","지금 상태를 유지해도 무리는 없을 것 같습니다.","한 박자 늦춰도 괜찮을 것 같습니다.",
      "굳이 앞서지 않아도 될 것 같습니다.","잠시 미뤄두는 선택도 괜찮을 것 같습니다.","지금은 더 보태지 않아도 충분할 것 같습니다.","방향을 크게 바꾸지 않아도 될 것 같습니다.",
      "말을 아껴도 괜찮을 것 같습니다.","판단을 나중에 해도 늦지 않을 것 같습니다.","굳이 확답하지 않아도 될 것 같습니다.","오늘은 정리하지 않아도 괜찮을 것 같습니다.",
      "서두르지 않는 쪽이 편할 것 같습니다.","지금의 선택을 유지해도 충분할 것 같습니다.","결정을 나누어 해도 괜찮을 것 같습니다.","굳이 증명하지 않아도 될 것 같습니다.",
      "오늘은 반응을 줄여도 괜찮을 것 같습니다.","방향을 그대로 두어도 무리는 없을 것 같습니다.","지금은 멈춰보는 것도 괜찮을 것 같습니다.","선택을 최소화해도 충분할 것 같습니다.",
      "말을 덜어내는 쪽이 나을 것 같습니다.","판단을 유보해도 괜찮을 것 같습니다.","지금의 흐름에 맡겨도 될 것 같습니다.","굳이 서두를 필요는 없을 것 같습니다.",
      "오늘은 조정하는 쪽이 편할 것 같습니다.","한 걸음 물러나도 괜찮을 것 같습니다.","방향을 고정하지 않아도 될 것 같습니다.","오늘은 유지하는 선택이 무난할 것 같습니다.",
      "굳이 나서지 않아도 괜찮을 것 같습니다.","선택을 보류해도 충분할 것 같습니다.","지켜보는 쪽이 나을 것 같습니다.","말보다 행동을 줄여도 괜찮을 것 같습니다.",
      "오늘은 무리하지 않는 편이 좋을 것 같습니다.","방향을 서서히 잡아도 될 것 같습니다.","굳이 완성하려 하지 않아도 괜찮을 것 같습니다.","선택을 남겨두는 것도 괜찮을 것 같습니다.",
      "지금의 판단을 믿지 않아도 괜찮을 것 같습니다.","오늘은 단순하게 두는 편이 나을 것 같습니다.","흐름을 방해하지 않는 쪽이 좋을 것 같습니다.","결론을 내리지 않아도 충분할 것 같습니다.",
      "오늘은 선택을 덜어내는 쪽이 나을 것 같습니다.","굳이 결론을 내리지 않아도 괜찮을 것 같습니다.","지금의 방향을 그대로 두어도 될 것 같습니다.","판단을 서두르지 않는 편이 편할 것 같습니다.",
      "오늘은 조정하지 않아도 충분할 것 같습니다.","선택을 남겨두는 쪽이 나을 것 같습니다.","굳이 설명하지 않아도 괜찮을 것 같습니다.","오늘은 반응을 줄이는 편이 좋을 것 같습니다.",
      "흐름을 따라가도 무리는 없을 것 같습니다.","지금은 유지에 가까운 선택이 편할 것 같습니다.","굳이 앞서서 결정하지 않아도 될 것 같습니다.","오늘은 방향을 고정하지 않는 편이 나을 것 같습니다.",
      "말을 아끼는 쪽이 부담이 적을 것 같습니다.","선택을 미뤄도 흐름이 깨지지 않을 것 같습니다.","오늘은 정리보다 유지가 나을 것 같습니다.","굳이 결과를 만들지 않아도 괜찮을 것 같습니다.",
      "지금의 상태를 존중해도 충분할 것 같습니다.","판단을 나중으로 넘겨도 무리는 없을 것 같습니다.","오늘은 크게 움직이지 않는 편이 좋을 것 같습니다.","선택을 줄이는 쪽이 편안할 것 같습니다.",
      "굳이 서두를 이유는 크지 않을 것 같습니다.","오늘은 결정을 가볍게 두어도 괜찮을 것 같습니다.","방향을 열어두는 선택이 나을 것 같습니다.","지금은 유지 쪽에 가까운 선택이 좋을 것 같습니다.",
      "오늘은 무리하지 않는 판단이 어울릴 것 같습니다.","굳이 앞장서지 않아도 괜찮을 것 같습니다.","선택을 단순하게 가져가도 충분할 것 같습니다.","오늘은 흐름을 방해하지 않는 편이 좋을 것 같습니다.",
      "결정을 미뤄두는 쪽가 편할 것 같습니다.","지금의 상태를 그대로 두는 선택이 나을 것 같습니다.","오늘은 조심스럽게 유지해도 괜찮을 것 같습니다.","방향을 확정하지 않아도 무리는 없을 것 같습니다.",
      "굳이 모든 걸 정리하지 않아도 괜찮을 것 같습니다.","선택을 가볍게 넘겨도 될 것 같습니다.","오늘은 판단을 덜어내는 편이 나을 것 같습니다.","굳이 반응하지 않아도 괜찮을 것 같습니다.",
      "지금은 유지에 집중해도 충분할 것 같습니다.","선택을 최소화하는 쪽이 편할 것 같습니다.","오늘은 조정 없이 두는 편이 나을 것 같습니다.","결론을 내리지 않는 선택도 괜찮을 것 같습니다."
    ];

    const DIRECTION = [
      "유지하는 선택이 편할 것 같습니다.","굳이 앞에 나서지 않아도 괜찮을 것 같습니다.","더 보태지 않아도 충분할 것 같습니다.","말을 줄이는 쪽이 나을 것 같습니다.",
      "지금 상태를 지키는 편이 무난할 것 같습니다.","흐름을 끊지 않는 선택이 좋을 것 같습니다.","조용히 지나가는 쪽이 편할 것 같습니다.","무리하지 않는 방향이 잘 맞을 것 같습니다.",
      "지금의 리듬을 유지하는 게 좋을 것 같습니다.","앞서기보다는 맞추는 쪽이 나을 것 같습니다.","서두르지 않는 태도가 어울릴 것 같습니다.","방향을 크게 바꾸지 않는 게 좋을 것 같습니다.",
      "잠시 멈추는 선택이 편할 것 같습니다.","여백을 남기는 쪽이 나을 것 같습니다.","지금 상태를 그대로 두는 게 좋을 것 같습니다.","굳이 나서지 않는 태도가 어울릴 것 같습니다.",
      "흐름에 맡기는 쪽이 편할 것 같습니다.","선택을 줄이는 게 좋을 것 같습니다.","방향을 유연하게 두는 게 좋을 것 같습니다.","오늘은 유지하는 쪽이 무난할 것 같습니다.",
      "조정하지 않아도 되는 방향이 좋을 것 같습니다.","지금의 흐름을 존중하는 게 좋을 것 같습니다.","크게 바꾸지 않는 선택이 편할 것 같습니다.","굳이 강조하지 않는 쪽이 나을 것 같습니다.",
      "속도를 낮추는 방향이 좋을 것 같습니다.","조용히 이어가는 태도가 어울릴 것 같습니다.","지금 상태에 머무는 게 편할 것 같습니다.","방향을 열어두는 쪽이 좋을 것 같습니다.",
      "오늘은 유지에 가까운 선택이 나을 것 같습니다.","흐름을 방해하지 않는 쪽이 편할 것 같습니다.",
      "오늘은 유지에 가까운 방향이 편할 것 같습니다.","흐름을 크게 바꾸지 않는 쪽이 좋을 것 같습니다.","조용히 이어가는 선택이 어울릴 것 같습니다.","지금의 리듬을 존중하는 방향이 나을 것 같습니다.",
      "앞서기보다는 맞추는 쪽이 편할 것 같습니다.","무리하지 않는 방향이 잘 어울릴 것 같습니다.","지금 상태를 지켜보는 선택이 좋을 것 같습니다.","방향을 열어두는 태도가 어울릴 것 같습니다.",
      "오늘은 유지하는 흐름이 자연스러울 것 같습니다.","흐름을 방해하지 않는 방향이 편할 것 같습니다."
    ];

    const TONES = ["REST","HOLD","FLOW","MOVE"];
    function sliceByTone(arr, tone){
      const idx = TONES.indexOf(tone);
      const chunk = Math.floor(arr.length / 4);
      const start = idx * chunk;
      const end = (idx === 3) ? arr.length : start + chunk;
      return arr.slice(start, end);
    }

    /********************
     * 저장/로드
     ********************/
    const PROFILE_KEY = "hannal_profile";
    function saveProfile(p){ localStorage.setItem(PROFILE_KEY, JSON.stringify(p)); }
    function loadProfile(){
      const raw = localStorage.getItem(PROFILE_KEY);
      if(!raw) return null;
      try { return JSON.parse(raw); } catch { return null; }
    }
    function buildBirthKey(p){
      const y = String(p.y).padStart(4,"0");
      const m = pad2(p.m);
      const d = pad2(p.d);
      if(!p.timeKnown) return `${y}${m}${d}`;
      const hh = pad2(p.hour);
      return `${y}${m}${d}${hh}00`;
    }

    /********************
     * 렌더
     ********************/
    function render(profile){
      const birthKey = buildBirthKey(profile);
      const seed = `${birthKey}_${todayKey()}`;

      const tone = decideTone(profile);
      const score = scoreFromTone(seed, tone);

      const S = sliceByTone(STATE, tone);
      const C = sliceByTone(CHOICE, tone);
      const D = sliceByTone(DIRECTION, tone);

      document.getElementById("todayDate").innerText = todayKorean();
      document.getElementById("score").innerText = score;
      document.getElementById("scoreDesc").innerText = scoreOneLine(score);

      document.getElementById("line1").innerText = pick(S, seed, "_S");
      document.getElementById("line2").innerText = pick(C, seed, "_C");
      document.getElementById("direction").innerText = pick(D, seed, "_D");
    }

    /********************
     * UI (자동 스크롤 없음)
     ********************/
    const pageRegister = document.getElementById("pageRegister");
    const registerTitle = document.getElementById("registerTitle");
    const form = document.getElementById("registerForm");
    const cancelBtn = document.getElementById("cancelBtn");
    const editBtn = document.getElementById("editBtn");
    const themeToggle = document.getElementById("themeToggle");

    const unknownTime = document.getElementById("unknownTime");
    const hourInput = document.getElementById("hour");

    function setTimeInputsState(){
      const disabled = unknownTime.checked;
      hourInput.disabled = disabled;
      if(disabled) hourInput.value = "";
    }
    unknownTime.addEventListener("change", setTimeInputsState);

    function isValidDate(y,m,d){
      const dt = new Date(y, m-1, d);
      return dt.getFullYear()===y && dt.getMonth()===(m-1) && dt.getDate()===d;
    }

    function fillForm(p){
      document.getElementById("year").value = p.y;
      document.getElementById("month").value = pad2(p.m);
      document.getElementById("day").value = pad2(p.d);
      unknownTime.checked = !p.timeKnown;
      setTimeInputsState();
      hourInput.value = p.timeKnown ? pad2(p.hour) : "";
    }

    function enterNormalMode(saved){
      // 등록 완료 후: 입력 페이지 숨김 (흐름 방해 X)
      pageRegister.classList.add("hidden");
      registerTitle.innerText = "생년월일시를 한 번만 적어두면 됩니다.";
      cancelBtn.classList.add("hidden");
      if(saved) render(saved);
    }

    function enterFirstRegisterMode(){
      pageRegister.classList.remove("hidden");
      registerTitle.innerText = "생년월일시를 한 번만 적어두면 됩니다.";
      cancelBtn.classList.add("hidden");
      requestAnimationFrame(()=>form.classList.add("show"));
    }

    function enterEditMode(saved){
      pageRegister.classList.remove("hidden");
      registerTitle.innerText = "정보수정";
      cancelBtn.classList.remove("hidden");
      fillForm(saved);
      requestAnimationFrame(()=>form.classList.add("show"));
    }

    cancelBtn.addEventListener("click", ()=>{
      const saved = loadProfile();
      if(saved) enterNormalMode(saved);
      else enterFirstRegisterMode();
    });

    editBtn.addEventListener("click", ()=>{
      const saved = loadProfile();
      if(!saved){
        enterFirstRegisterMode();
        return;
      }
      enterEditMode(saved);
    });

    themeToggle.addEventListener("click", ()=>{
      const current = root.getAttribute("data-theme"); // "dark" | "light" | null
      if (current === "dark") applyTheme("light");
      else if (current === "light") applyTheme(null); // 기기 설정으로 복귀
      else applyTheme("dark");
    });

    form.addEventListener("submit", (e)=>{
      e.preventDefault();
      const y = parseInt(document.getElementById("year").value, 10);
      const m = parseInt(document.getElementById("month").value, 10);
      const d = parseInt(document.getElementById("day").value, 10);

      if(!y || !m || !d || !isValidDate(y,m,d)){
        alert("생년월일을 다시 확인해주세요.");
        return;
      }

      const timeKnown = !unknownTime.checked;
      let hour = 0;

      if(timeKnown){
        const h = hourInput.value.trim();
        if(h === ""){
          alert("출생시간을 모르면 '출생시간 모름'을 체크해주세요.");
          return;
        }
        hour = parseInt(h, 10);
        if(Number.isNaN(hour) || hour < 0 || hour > 23){
          alert("출생시간(시)은 0~23 사이로 입력해주세요.");
          return;
        }
      }

      const profile = { y, m, d, timeKnown, hour };
      saveProfile(profile);

      // ✅ 저장해도 자동 화면전환 없음
      // 사용자가 스크롤로 운세 페이지를 만나게 둠
      enterNormalMode(profile);
    });

    /* 초기 */
    setTimeInputsState();
    const saved = loadProfile();
    requestAnimationFrame(()=>form.classList.add("show"));
    if(saved) enterNormalMode(saved);
    else enterFirstRegisterMode();
  </script>
</body>
</html>
